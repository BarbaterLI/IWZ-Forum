{% extends "base.html" %}
{% from 'macros.html' import render_pagination %}

{% block title %}请求日志 - IWZ-Forum{% endblock %}

{% block content %}
<div class="post-card mb-4">
    <div class="d-flex justify-content-between align-items-center">
        <h2 class="mb-0"><i class="fas fa-clipboard-list me-2"></i>请求日志</h2>
        <div>
            <a href="{{ url_for('advanced.admin_logs') }}?days=1" class="btn btn-outline-primary btn-sm">最近1天</a>
            <a href="{{ url_for('advanced.admin_logs') }}?days=7" class="btn btn-outline-primary btn-sm">最近7天</a>
            <a href="{{ url_for('advanced.admin_logs') }}?days=30" class="btn btn-outline-primary btn-sm">最近30天</a>
        </div>
    </div>
</div>

<div class="post-card">
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-light">
                <tr>
                    <th>时间</th>
                    <th>IP地址</th>
                    <th>用户</th>
                    <th>方法</th>
                    <th>URL</th>
                    <th>状态</th>
                    <th>响应时间</th>
                    <th>用户代理</th>
                </tr>
            </thead>
            <tbody>
                {% for log in logs.items %}
                <tr>
                    <td>{{ log.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                    <td>{{ log.ip_address }}</td>
                    <td>
                        {% if log.user %}
                            <a href="{{ url_for('main.user_detail', user_id=log.user.id) }}">{{ log.user.username }}</a>
                        {% else %}
                            匿名用户
                        {% endif %}
                    </td>
                    <td>
                        <span class="badge bg-secondary">{{ log.method }}</span>
                    </td>
                    <td>
                        <small>{{ log.url[:50] }}{% if log.url|length > 50 %}...{% endif %}</small>
                    </td>
                    <td>
                        {% if log.status_code >= 200 and log.status_code < 300 %}
                            <span class="badge bg-success">{{ log.status_code }}</span>
                        {% elif log.status_code >= 400 and log.status_code < 500 %}
                            <span class="badge bg-warning">{{ log.status_code }}</span>
                        {% elif log.status_code >= 500 %}
                            <span class="badge bg-danger">{{ log.status_code }}</span>
                        {% else %}
                            <span class="badge bg-info">{{ log.status_code }}</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if log.response_time %}
                            <span class="text-muted">{{ "%.2f"|format(log.response_time) }}ms</span>
                        {% endif %}
                    </td>
                    <td>
                        <small>{{ log.user_agent[:30] }}{% if log.user_agent|length > 30 %}...{% endif %}</small>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- 分页 -->
{{ render_pagination(logs, 'advanced.admin_logs') }}
</div>
{% endblock %}
