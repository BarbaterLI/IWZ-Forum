{% extends "base.html" %}

{% block title %}{{ category.name }} - 论坛系统{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        <div class="post-card mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2><i class="fas fa-folder me-2 text-primary"></i>{{ category.name }}</h2>
                {% if current_user.is_authenticated %}
                <a href="{{ url_for('main.create_post', category_id=category.id) }}" class="btn btn-primary">
                    <i class="fas fa-plus me-1"></i>发表新帖
                </a>
                {% endif %}
            </div>
            <p class="text-muted">{{ category.description or '暂无描述' }}</p>
        </div>

        {% if posts %}
            {% for post in posts %}
            <div class="post-card mb-3">
                <h5 class="post-title">
                    <a href="{{ url_for('main.post_detail', post_id=post.id) }}" class="text-decoration-none">{{ post.title }}</a>
                    {% if post.is_essence %}
                    <span class="badge bg-warning text-dark ms-2">精华</span>
                    {% endif %}
                </h5>
                <div class="post-meta">
                    <i class="fas fa-user"></i> {{ post.author.username }} 
                    <i class="fas fa-clock ms-3"></i> {{ post.created_at.strftime('%Y-%m-%d %H:%M') }}
                    <i class="fas fa-eye ms-3"></i> {{ post.view_count }} 浏览
                    <i class="fas fa-comment ms-3"></i> {{ post.comments.count() }} 回复
                </div>
                {% if current_user.is_authenticated %}
                <div class="mt-2">
                    {% set upvotes, downvotes = post.get_vote_count() %}
                    <span class="badge bg-success"><i class="fas fa-thumbs-up me-1"></i> {{ upvotes }}</span>
                    <span class="badge bg-danger"><i class="fas fa-thumbs-down me-1"></i> {{ downvotes }}</span>
                </div>
                {% endif %}
                <div class="post-content">
                    {{ post.get_content_preview(200) }}
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="post-card text-center">
                <i class="fas fa-inbox fa-2x text-muted mb-3"></i>
                <p class="mb-0">该版块暂无帖子，快来发表第一个帖子吧！</p>
            </div>
        {% endif %}
    </div>
    
    <div class="col-lg-4">
        <!-- 版块信息 -->
        <div class="post-card mb-4">
            <h4 class="mb-3"><i class="fas fa-info-circle me-2 text-info"></i>版块信息</h4>
            <ul class="list-group list-group-flush">
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    帖子数
                    <span class="badge bg-primary rounded-pill">{{ category.posts.count() }}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    创建时间
                    <span>{{ category.created_at.strftime('%Y-%m-%d') }}</span>
                </li>
            </ul>
        </div>
        
<!-- 版块列表 -->
        <div class="post-card">
            <h4 class="mb-3"><i class="fas fa-folder me-2 text-primary"></i>其他版块</h4>
            <div class="list-group">
                {% for cat in all_categories %}
                {% if cat.id != category.id %}
                <a href="{{ url_for('main.category_detail', category_id=cat.id) }}" class="list-group-item list-group-item-action">
                    <div class="d-flex justify-content-between align-items-center">
                        <span>{{ cat.name }}</span>
                        <span class="badge bg-secondary">{{ cat.posts.count() }}</span>
                    </div>
                </a>
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
